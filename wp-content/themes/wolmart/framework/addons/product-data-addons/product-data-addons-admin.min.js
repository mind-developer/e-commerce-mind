!function(t,a){"use strict";window.WolmartAdmin=WolmartAdmin||{};var e={init:function(){var t=this;a(".wolmart_custom_labels .color-picker").wpColorPicker(),a("#wolmart_virtual_buy_time").length&&a.fn.datepicker&&a("#wolmart_virtual_buy_time").datepicker({defaultDate:"",dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0,maxDate:new Date}),a(".save_wolmart_product_options").on("click",t.onExtraSave),a("#wolmart_add_custom_label").on("click",t.addLabel),a(".wolmart_custom_labels").on("click",".delete",t.removeLabel),a(".wolmart_custom_labels").on("change",".custom_label_type",t.typeSelected),a(document).off("click",".btn_upload_img").on("click",".btn_upload_img",t.uploadFile),t.sortableLabels()},addLabel:function(){var t=a(this).closest(".form-field");t.siblings(".wc-metabox-template").clone().show().appendTo(t.find(".wc-metaboxes")),a.fn.wpColorPicker&&(t.find(".color-picker").addClass("wolmart-color-picker"),t.find("input.wolmart-color-picker").wpColorPicker())},removeLabel:function(t){t.preventDefault(),a(this).closest(".wc-metabox").remove()},typeSelected:function(){a(this).val()?(a(this).siblings(".text-controls").hide(),a(this).siblings(".image-controls").show()):(a(this).siblings(".image-controls").hide(),a(this).siblings(".text-controls").show())},uploadFile:function(e){var o,l=a(this),i=l.prev(),r=l.next();o||(o=t.media.frames.downloadable_file=t.media({title:"Choose an image",button:{text:"Use image"},multiple:!1})),o.open(),o.on("select",(function(){var t=o.state().get("selection").first().toJSON();i.val(t.url),o.close(),r.val(t.id)})),e.preventDefault()},sortableLabels:function(){a(".wolmart_custom_labels .wc-metaboxes").sortable({items:".wc-metabox",cursor:"move",axis:"y",handle:"h3",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(t,a){a.item.css("background-color","#f6f6f6")},stop:function(t,a){a.item.removeAttr("style")}})},onExtraSave:function(t){t.preventDefault();var e=[],o=a("#wolmart_data_addons");e.wolmart_custom_labels=[],e.wolmart_virtual_buy_time=a("#wolmart_virtual_buy_time").val(),e.wolmart_virtual_buy_time_text=a("#wolmart_virtual_buy_time_text").val(),a(".wolmart_custom_labels").find(".wc-metabox").each((function(){var t={};t.type=a(this).find(".custom_label_type").val(),t.type?(t.img_url=a(this).find(".label_image").val(),t.img_id=a(this).find(".label_image_id").val()):(t.label=a(this).find(".label_text").val(),t.color=a(this).find('[name="label_color"]').val(),t.bgColor=a(this).find('[name="label_bgcolor"]').val()),(!t.type&&t.label||t.type&&t.img_url)&&e.wolmart_custom_labels.push(t)})),o.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),a.ajax({type:"POST",dataType:"json",url:wolmart_product_data_addon_vars.ajax_url,data:{action:"wolmart_save_product_extra_options",nonce:wolmart_product_data_addon_vars.nonce,post_id:wolmart_product_data_addon_vars.post_id,wolmart_custom_labels:e.wolmart_custom_labels,wolmart_virtual_buy_time:e.wolmart_virtual_buy_time,wolmart_virtual_buy_time_text:e.wolmart_virtual_buy_time_text},success:function(){o.unblock(),Array("wolmart_custom_labels","wolmart_virtual_buy_time","wolmart_virtual_buy_time_text").forEach((t=>{var o=a('[value="'+t+'"]').closest("tr").attr("id"),l=e[t];a("#"+o+"-value").html(JSON.stringify(l))}))}})},onCancel:function(t){confirm("Changes are cancelled. Do you want to reload this page?")&&window.location.reload()}};WolmartAdmin.productDataAddons=e,a(document).ready((function(){WolmartAdmin.productDataAddons.init()}))}(wp,jQuery);